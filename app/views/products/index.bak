<section class="catalog-hero">
  <div class="hero-left">
    <p class="eyebrow">–®–≤–∏–¥–∫–∏–π –≤–∏–±—ñ—Ä</p>
    <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä—ñ–≤</h1>
    <p class="lead">–•–∞—Ä—á—É–≤–∞–Ω–Ω—è, –¥–æ–≥–ª—è–¥ —Ç–∞ –∞–∫—Å–µ—Å—É–∞—Ä–∏ –¥–ª—è –∫–æ—Ç—ñ–≤, —Å–æ–±–∞–∫, –ø—Ç–∞—Ö—ñ–≤, –≥—Ä–∏–∑—É–Ω—ñ–≤ —ñ –Ω–µ —Ç—ñ–ª—å–∫–∏.</p>
  </div>
  <div class="hero-right">
    <div class="hero-pill">–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –≤—ñ–¥ 999 ‚Ç¥</div>
    <div class="hero-pill soft">–û–ø–ª–∞—Ç–∞ –æ–Ω–ª–∞–π–Ω / –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ</div>
  </div>
</section>

<% animals = [
  { key: "dogs",    label: "–°–æ–±–∞–∫–∞–º", icon: "üê∂" },
  { key: "cats",    label: "–ö–æ—Ç–∞–º", icon: "üê±" },
  { key: "birds",   label: "–ü—Ç–∞—Ö–∞–º", icon: "üê¶" },
  { key: "rodents", label: "–ì—Ä–∏–∑—É–Ω–∞–º", icon: "üêπ" },
  { key: "fish",    label: "–†–∏–±–∫–∞–º", icon: "üê†" },
  { key: "other",   label: "–Ü–Ω—à–∏–º", icon: "‚ú®" }
] %>

<div class="catalog-tabs">
  <% animals.each do |animal| %>
    <% animal_categories = (@categories_by_animal[animal[:key]] || []) %>
    <div class="tab-item">
      <span class="tab-icon"><%= animal[:icon] %></span>
      <span><%= animal[:label] %></span>
      <div class="tab-underline"></div>
      <div class="mega-panel">
        <div class="mega-header">
          <div>
            <h3><%= animal[:label] %></h3>
            <p class="muted">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–ª—è <%= animal[:label].downcase %></p>
          </div>
          <%= link_to "–í—Å—ñ —Ç–æ–≤–∞—Ä–∏", root_path(animal: animal[:key]), class: "btn btn-xs" %>
        </div>
        <div class="mega-columns">
          <% if animal_categories.empty? %>
            <div class="mega-col muted">–ù–µ–º–∞—î –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</div>
          <% else %>
            <% animal_categories.each_slice(4) do |slice| %>
              <div class="mega-col">
                <% slice.each do |c| %>
                  <%= link_to c.name, root_path(category_id: c.id, animal: animal[:key]), class: "mega-link" %>
                <% end %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
  <div class="tab-item muted-tab">
    <span class="tab-icon">‚≠ê</span><span>–ë—Ä–µ–Ω–¥–∏</span>
  </div>
  <div class="tab-item muted-tab">
    <span class="tab-icon">%</span><span>–ê–∫—Ü—ñ—ó</span>
  </div>
  <div class="tab-item muted-tab">
    <span class="tab-icon">üîî</span><span>–ë–ª–æ–≥</span>
  </div>
</div>

<section class="section-block">
  <div class="section-head">
    <h2>–£—Å—ñ —Ç–æ–≤–∞—Ä–∏</h2>
    <div class="filters-inline">
      <%= form_with url: root_path, method: :get, local: true, class: "filter-form" do %>
        <%= hidden_field_tag :animal, @animal if @animal %>
        <%= text_field_tag :q, @q, placeholder: "–ü–æ—à—É–∫ –∑–∞ –Ω–∞–∑–≤–æ—é", class: "pill-input" %>
        <%= submit_tag "–ó–Ω–∞–π—Ç–∏", class: "btn btn-sm" %>
      <% end %>
    </div>
  </div>

  <% if @products.empty? %>
    <p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>
  <% end %>

  <div class="cards alt-grid">
    <% placeholder = asset_path("placeholder.svg") %>
    <% @products.each do |p| %>
      <div class="card product-card">
        <div class="muted"><%= p.category&.name %></div>
        <h3><%= link_to p.title, product_path(p) %></h3>
        <%= image_tag(
              p.image_url.presence || placeholder,
              alt: p.title,
              class: "thumb",
              loading: "lazy",
              onerror: "this.onerror=null;this.src='#{placeholder}'"
            ) %>
        <div class="row">
          <div class="price"><%= number_to_currency(p.price, unit: "‚Ç¥", format: "%n %u") %></div>
          <div class="muted">–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ: <%= p.stock.to_i %></div>
        </div>
        <div class="row">
          <%= link_to "–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ", product_path(p), class: "btn btn-sm" %>
          <%= button_to "–£ –∫–æ—à–∏–∫", add_cart_path(product_id: p.id), method: :post, class: "btn btn-sm" %>
        </div>
      </div>
    <% end %>
  </div>
</section>
